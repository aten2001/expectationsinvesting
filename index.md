# Georgia Tech CS 7641 - Machine Learning
## Spring 2020 Final Project: Expectations Investing
#### Daeil Cha, Paula Gluss, Chad Hayes, Hyun Jae Park, Brett Watanabe


## Motivation
Our objective is to infer stock market expectations of future company performance. In its simplest form, a stock price represents all future expectations about a company. But the stock market is ‘wrong’ many times and miscalculates future performance. Herein lies the opportunity for an investor: if he has a confident view on a company’s future performance and suspects the market’s expectations of said performance are wrong, then he has a chance to profitably trade the company’s stock. This concept is a fundamental cornerstone of investing.

As such, our goal is to predict when the market will miscalculate future company performance. To our knowledge, this is a completely novel approach. We will first infer the market’s expectations (using a concept called ‘expectations investing’), then compare those to actual performance. Finally, we will investigate what features are most important in causing the market to miscalculate performance. We will assess the quality of our model and also calculate the hypothetical return of an opportunistic investor that has foreknowledge of the market’s miscalculations. To be clear, we are not trying to predict stock returns.


## Background

### A Brief Primer Into Calculating Stock Prices
For context, we need to briefly discuss the calculation of stock prices. This will explain exactly what we are calculating in our model. In the most basic form, the traditional method of calculating the total value of a company is a summation of the all the future cash flows expected to be generated by the company:

(i) Company value (today) = Sum(cash_flow_i) for i = 1 to infinity

In reality, each future cash flow is discounted by some discount factor (the “weighted average cost of capital,” or WACC) because the future generally carries more risk. So the formula becomes this:

(ii) Company value (today) = Sum(cash_flow_i / (1 + WACC^i)) for i = 1 to infinity

To derive each cash flow, for simplicity we assume some growth rate from today’s cash flow (cash_flow_0^i). But note that the summation goes to infinity and since no business can grow into infinite value, we have to make some adjustments. We assume the company’s cash flow will grow at some rate g1 for the nearterm (say, 10 years), then another rate g2 into perpetuity. So the formula becomes:

(iii) Company value (today)  = Sum(cash_flow_0 * \[(1 + g1) / (1 + WACC)\]^i) for i = 1 to 10 + Sum(cash_flow_10 * \[(1+g2) / (1 + WACC)\]^i) for i = 11 to infinity

Note that the second term of the right side is a perpetuity. So we can rewrite the equation:

(iv) Company value (today)  = Sum(cash_flow_0 * \[(1 + g1) / (1 + WACC)\]^i) for i = 1 to 10 + cash_flow_10 * (1 / \[WACC - g2\])

Finally, to derive the current stock price, we simply divide the company value by the company’s diluted shares outstanding. For more information about this calculation, see the following link: https://en.wikipedia.org/wiki/Discounted_cash_flow

### Expectations Investing
The preceding section describes how an investor derives his own opinion of a company’s stock price. But what if we want to do the reverse? That is, the stock market’s opinion of value is simply the price a stock trades at any given time; how can we then derive the stock’s markets implicit assumptions of a company’s cash flow growth? In the framework we laid out so far, this means **we want to solve for g1 (the near-term growth rate of cash flows)**. We will then compare the ‘market-implied’ expectation of g1 to the actual near-term growth rate realized by each company. For simplicity, we assessed the 1-year growth in cash flow. 

It is straightforward to solve for the price-implied expectation of g1 by using optimization software. In equation (iv), we know the values of all the variables except for g1 and g2. Typically, g2 is assumed to be some rate lower than inflation (otherwise, the company would exceed the value of the world, which is impossible). For a deep dive into this concept of price-implied expectations of financial performance and for the inspiration behind our approach, see the following link: http://www.expectationsinvesting.com/default.shtml


## Data Collection, Exploration, and Pre-Processing

### Data Collection
We obtained the majority of our data from [Wharton Research Data Services (WRDS)|https://wrds-www.wharton.upenn.edu/], a database with a vast array of business data. For our purposes, we obtained company-specific quarterly numerical and categorical data. We also obtained macro-economic data from a variety of government websites. 

### Data Wrangling, Feature Engineering
The process of transforming the data was considerably extensive. We had to manually calculate the true cash flow for each company, which required knowledge of finance and accounting. We dealt with outliers by inspecting each feature’s distribution and using an intuitive understanding of what they represent. For instance, the ratio of debt to invested capital cannot be negative. We also kept data that was within 3 standard deviations of each datapoint’s respective distribution. We then scaled the numerical data with scikit-learn’s RobustScaler. For a full list of each datapoint, their abbreviations, and what they represent, see the appendix. 

### Exploratory Data Analysis
We explored the relationship between features and our label (which we call “market error”) by visualizing the marginal relationships between them. This gave us an idea of which features are important in our analysis, and how they impact the label ‘market error.’ For instance, we found a negative correlation between the growth in GDP and the market error. This is an intriguing, somewhat counterintuitive finding.

![GDP vs. Market Error Plot](/plots/gdp_vs_market_error.png)

We also explored the correlation between our features. Interestingly, the correlations between company performance metrics are quite low, but they are more pronounced for macro-economic indicators. See below:

![Correlation Plot](/plots/correlation.png)

Finally, we used Lasso regression to investigate the resulting coefficients to judge which features are not impactful to the label. See below:

![Lasso without removing variables](/plots/lasso_before.png)

Clearly, we can eliminate some features. We simply omitted those features with 0 values for coefficients, which reduced our feature-set from 43 to 15.

![Lasso after removing variables](/plots/lasso_after.png)

Now we are ready for modeling.

## Methods

### Supervised Learning and Prediction of Market Expectations

### **Don't forget to update this** Unsupervised Something Cuz Grading Requirements


## Results and Discussion
- ROC Curves
- AUROC Scores by Model

## Conclusions and Limitations

## References

https://data.oecd.org/leadind/business-confidence-index-bci.htm
https://data.oecd.org/leadind/consumer-confidence-index-cci.htm
https://data.oecd.org/price/inflation-forecast.htm
https://en.wikipedia.org/wiki/Discounted_cash_flow
https://fred.stlouisfed.org/series/INDPRO
https://fred.stlouisfed.org/series/PCEC96
https://fred.stlouisfed.org/series/GDP
https://wrds-web.wharton.upenn.edu/wrds/process/wrds.cfm
https://www.bls.gov/charts/employment-situation/civilian-unemployment-rate.htm
https://www.eia.gov/dnav/pet/hist/LeafHandler.ashx?n=pet&s=f000000__3&f=m
http://www.expectationsinvesting.com/default.shtml

## Contributions
Proposal: All
Data Collection: Daeil
Data Wrangling: All
Exploratory Data Analysis: Hyun Jae
Variable Selection: Paula
Visualization: Paula, Hyun Jae
Modeling: Chad
Analysis and Conclusion: Brett and all
Github and Writeup: All

## Appendix

**In Progress**




# Reference Stuff From Github (Delete this after y'all have seen it)

### Markdown

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/bkwatanabe/expectationsinvesting.github.io/settings). The name of this theme is saved in the Jekyll `_config.yml` configuration file.
